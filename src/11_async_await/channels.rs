//! # Async Channels - р╕гр╕░р╕Ър╕Ър╕кр╕╖р╣Ир╕нр╕кр╕▓р╕гр╣Бр╕лр╣Ир╕Зр╕нр╕Щр╕▓р╕Др╕Х! ЁЯУбтЪб
//!
//! р╣Др╕Яр╕ер╣Мр╕Щр╕╡р╣Йр╣Ар╕Ыр╣Зр╕Щр╕ир╕╣р╕Щр╕вр╣Мр╕Бр╕ер╕▓р╕Зр╕Бр╕▓р╕гр╕кр╕╖р╣Ир╕нр╕кр╕▓р╕гр╣Бр╕Ър╕Ъ async р╕Чр╕╡р╣Ир╕Ир╕░р╕Чр╕│р╣Гр╕лр╣Йр╕Др╕╕р╕Ур╣Ар╕Ыр╣Зр╕Щр╕Щр╕▒р╕Бр╕кр╕╖р╣Ир╕нр╕кр╕▓р╕гр╕бр╕╖р╕нр╕нр╕▓р╕Кр╕╡р╕Ю! ЁЯОнтЬи
//!
//! ## р╕кр╕┤р╣Ир╕Зр╕Чр╕╡р╣Ир╕Ир╕░р╣Др╕Фр╣Йр╣Ар╕гр╕╡р╕вр╕Щр╕гр╕╣р╣Й: ЁЯОп
//! - ЁЯУб Tokio Channels - р╕гр╕░р╕Ър╕Ър╕кр╕╖р╣Ир╕нр╕кр╕▓р╕гр╣Бр╕лр╣Ир╕Зр╕нр╕Щр╕▓р╕Др╕Х! (р╕зр╕┤р╕Чр╕вр╕╕р╕кр╕╖р╣Ир╕нр╕кр╕▓р╕г!)
//! - ЁЯСе MPSC Channels - р╕лр╕ер╕▓р╕вр╕Др╕Щр╕кр╣Ир╕З р╕Др╕Щр╣Ар╕Фр╕╡р╕вр╕зр╕гр╕▒р╕Ъ! (р╣Др╕Ыр╕гр╕йр╕Ур╕╡р╕вр╣Мр╕лр╕ер╕▓р╕вр╕кр╕▓р╕Вр╕▓!)
//! - ЁЯОп Oneshot Channels - р╕кр╣Ир╕Зр╕Др╕гр╕▒р╣Йр╕Зр╣Ар╕Фр╕╡р╕вр╕з р╕Ир╕Ъ! (р╕Ир╕Фр╕лр╕бр╕▓р╕вр╕Фр╣Ир╕зр╕Щ!)
//! - ЁЯУв Broadcast Channels - р╕Ыр╕гр╕░р╕Бр╕▓р╕ир╕Вр╣Ир╕▓р╕зр╕Чр╕▒р╣Ир╕зр╣Вр╕ер╕Б! (р╕лр╕нр╕Бр╕гр╕░р╕Ир╕▓р╕вр╕Вр╣Ир╕▓р╕з!)
//! - ЁЯдЭ Task Coordination - р╕Бр╕▓р╕гр╕Ыр╕гр╕░р╕кр╕▓р╕Щр╕Зр╕▓р╕Щр╣Бр╕Ър╕Ър╣Ар╕Чр╕Ю! (р╕Ьр╕╣р╣Йр╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Чр╕╡р╕б!)
//!
//! ЁЯОк р╣Ар╕Хр╕гр╕╡р╕вр╕бр╕Хр╕▒р╕зр╣Гр╕лр╣Йр╕Юр╕гр╣Йр╕нр╕б! р╣Ар╕гр╕▓р╕Ир╕░р╕бр╕▓р╣Ар╕гр╕╡р╕вр╕Щр╕гр╕╣р╣Йр╕ир╕┤р╕ер╕Ыр╕░р╕Бр╕▓р╕гр╕кр╕╖р╣Ир╕нр╕кр╕▓р╕гр╣Бр╕Ър╕Ъ async р╕Бр╕▒р╕Щ! ЁЯЪАЁЯУ╗

use std::time::Duration;
use tokio::sync::{broadcast, mpsc, oneshot};
use tokio::time::sleep;

/// р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╣Гр╕Кр╣Й channels р╕кр╕│р╕лр╕гр╕▒р╕Ъ communication - р╣Др╕Ыр╕гр╕йр╕Ур╕╡р╕вр╣Мр╣Бр╕лр╣Ир╕Зр╕нр╕Щр╕▓р╕Др╕Х! ЁЯУотЪб
pub async fn channels_example() {
    println!("\nЁЯУбтЬи === р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З Async Channels: р╣Др╕Ыр╕гр╕йр╕Ур╕╡р╕вр╣Мр╣Бр╕лр╣Ир╕Зр╕нр╕Щр╕▓р╕Др╕Х! === тЬиЁЯУб");
    println!("ЁЯОп р╣Ар╕Хр╕гр╕╡р╕вр╕бр╕Юр╕Ър╕Бр╕▒р╕Ър╕гр╕░р╕Ър╕Ър╕кр╣Ир╕Зр╕Ир╕Фр╕лр╕бр╕▓р╕вр╕Чр╕╡р╣Ир╣Др╕бр╣Ир╣Ар╕Др╕вр╕бр╕╡р╕бр╕▓р╕Бр╣Ир╕нр╕Щ! (р╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╕гр╕нр╕Др╕┤р╕зр╕Щр╕▓р╕Щ!) ЁЯЪА");

    let (tx, mut rx) = tokio::sync::mpsc::channel::<String>(10); // р╕Бр╕ер╣Ир╕нр╕Зр╕Ир╕Фр╕лр╕бр╕▓р╕вр╕Вр╕Щр╕▓р╕Ф 10 р╣Гр╕Ъ! ЁЯУо

    // Producer task - р╕Ър╕╕р╕гр╕╕р╕йр╣Др╕Ыр╕гр╕йр╕Ур╕╡р╕вр╣Мр╣Бр╕лр╣Ир╕Зр╕нр╕Щр╕▓р╕Др╕Х! ЁЯСитАНЁЯТ╝ЁЯУо
    let producer = tokio::spawn(async move {
        println!("ЁЯСитАНЁЯТ╝ р╕Ър╕╕р╕гр╕╕р╕йр╣Др╕Ыр╕гр╕йр╕Ур╕╡р╕вр╣Мр╣Ар╕гр╕┤р╣Ир╕бр╕Зр╕▓р╕Щ! р╣Ар╕Хр╕гр╕╡р╕вр╕бр╕кр╣Ир╕Зр╕Ир╕Фр╕лр╕бр╕▓р╕в 5 р╕Йр╕Ър╕▒р╕Ъ! ЁЯУмтЬи");
        for i in 1..=5 {
            let message = format!("ЁЯУЬ р╕Ир╕Фр╕лр╕бр╕▓р╕вр╕бр╕лр╕▒р╕ир╕Ир╕гр╕гр╕вр╣М #{i} (р╕кр╣Ир╕Зр╕Фр╣Йр╕зр╕вр╕Др╕зр╕▓р╕бр╕гр╕▒р╕Б! ЁЯТХ)");
            println!("ЁЯУдЁЯЪА р╕кр╣Ир╕З: {message}");

            if tx.send(message).await.is_err() {
                println!("тЭМЁЯТе р╣Вр╕нр╣Кр╕░р╣Вр╕н! р╕Бр╕ер╣Ир╕нр╕Зр╕Ир╕Фр╕лр╕бр╕▓р╕вр╣Ар╕Хр╣Зр╕б! (р╕лр╕гр╕╖р╕нр╣Др╕бр╣Ир╕бр╕╡р╣Гр╕Др╕гр╕гр╕▒р╕Ъ!) ЁЯШ▒");
                break;
            }

            sleep(Duration::from_millis(300)).await; // р╕Юр╕▒р╕Бр╣Ар╕Вр╕╡р╕вр╕Щр╕Ир╕Фр╕лр╕бр╕▓р╕вр╕Йр╕Ър╕▒р╕Ър╕Хр╣Ир╕нр╣Др╕Ы! тЬНя╕П
        }
        println!("ЁЯУдЁЯОЙ р╕Ър╕╕р╕гр╕╕р╕йр╣Др╕Ыр╕гр╕йр╕Ур╕╡р╕вр╣Мр╣Ар╕кр╕гр╣Зр╕Ир╕Зр╕▓р╕Щ! р╕кр╣Ир╕Зр╕Ир╕Фр╕лр╕бр╕▓р╕вр╕Др╕гр╕Ър╣Бр╕ер╣Йр╕з! (р╣Др╕Фр╣Йр╣Ар╕Зр╕┤р╕Щр╣Ар╕Фр╕╖р╕нр╕Щ!) ЁЯТ░");
    });

    // Consumer task - р╕Др╕Щр╕гр╕▒р╕Ър╕Ир╕Фр╕лр╕бр╕▓р╕вр╕Ьр╕╣р╣Йр╕нр╕Фр╕Чр╕Щ! ЁЯСйтАНЁЯТ╝ЁЯУм
    let consumer = tokio::spawn(async move {
        println!("ЁЯСйтАНЁЯТ╝ р╕Др╕Щр╕гр╕▒р╕Ър╕Ир╕Фр╕лр╕бр╕▓р╕вр╕Юр╕гр╣Йр╕нр╕бр╣Бр╕ер╣Йр╕з! р╕гр╕нр╕Ир╕Фр╕лр╕бр╕▓р╕вр╕бр╕▓р╕Цр╕╢р╕З... ЁЯУмЁЯСА");
        let mut count = 0;
        while let Some(message) = rx.recv().await {
            count += 1;
            println!("ЁЯУеЁЯТЦ р╕гр╕▒р╕Ър╕Ир╕Фр╕лр╕бр╕▓р╕вр╕Чр╕╡р╣И {count}: {message} (р╕нр╣Ир╕▓р╕Щр╕Фр╣Йр╕зр╕вр╕Др╕зр╕▓р╕бр╕Хр╕╖р╣Йр╕Щр╕Хр╕▒р╕Щ!) ЁЯШК");
            sleep(Duration::from_millis(100)).await; // р╕нр╣Ир╕▓р╕Щр╕Ир╕Фр╕лр╕бр╕▓р╕вр╕нр╕вр╣Ир╕▓р╕Зр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф! ЁЯСУ
        }
        println!("ЁЯУеЁЯПЖ р╕Др╕Щр╕гр╕▒р╕Ър╕Ир╕Фр╕лр╕бр╕▓р╕вр╣Ар╕кр╕гр╣Зр╕Ир╕Зр╕▓р╕Щ! р╕нр╣Ир╕▓р╕Щр╕Ир╕Фр╕лр╕бр╕▓р╕вр╕Др╕гр╕Ъ {count} р╕Йр╕Ър╕▒р╕Ър╣Бр╕ер╣Йр╕з! (р╕Др╕зр╕▓р╕бр╕кр╕╕р╕Вр╕ер╣Йр╕Щр╕лр╕▒р╕зр╣Гр╕И!) ЁЯТЭ");
    });

    // р╕гр╕нр╣Гр╕лр╣Йр╕Чр╕▒р╣Йр╕Зр╕кр╕нр╕З tasks р╣Ар╕кр╕гр╣Зр╕И - р╕гр╕нр╣Гр╕лр╣Йр╣Др╕Ыр╕гр╕йр╕Ур╕╡р╕вр╣Мр╕Ыр╕┤р╕Ф! ЁЯПв
    println!("тП│ р╕гр╕нр╣Гр╕лр╣Йр╕гр╕░р╕Ър╕Ър╣Др╕Ыр╕гр╕йр╕Ур╕╡р╕вр╣Мр╕Чр╕│р╕Зр╕▓р╕Щр╣Ар╕кр╕гр╣Зр╕И... (р╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▒р╕Зр╕зр╕е р╣Др╕бр╣Ир╕Ър╕ер╣Зр╕нр╕Бр╣Гр╕Др╕г!) ЁЯШМ");
    let _ = tokio::join!(producer, consumer);
    println!("ЁЯОК р╕гр╕░р╕Ър╕Ър╣Др╕Ыр╕гр╕йр╕Ур╕╡р╕вр╣Мр╣Бр╕лр╣Ир╕Зр╕нр╕Щр╕▓р╕Др╕Хр╕Чр╕│р╕Зр╕▓р╕Щр╣Ар╕кр╕гр╣Зр╕Ир╕кр╕┤р╣Йр╕Щ! р╕Чр╕╕р╕Бр╕Др╕Щр╕бр╕╡р╕Др╕зр╕▓р╕бр╕кр╕╕р╕В! ЁЯМИтЬи");
}

/// р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╣Гр╕Кр╣Й multiple producers - р╕Чр╕╡р╕бр╕Ър╕╕р╕гр╕╕р╕йр╣Др╕Ыр╕гр╕йр╕Ур╕╡р╕вр╣Мр╕Лр╕╣р╣Ар╕Ыр╕нр╕гр╣М! ЁЯСеЁЯУотЪб
pub async fn multiple_producers_example() {
    println!("\nЁЯСеЁЯЪА === р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З Multiple Producers: р╕Чр╕╡р╕бр╕Ър╕╕р╕гр╕╕р╕йр╣Др╕Ыр╕гр╕йр╕Ур╕╡р╕вр╣Мр╕Лр╕╣р╣Ар╕Ыр╕нр╕гр╣М! === ЁЯЪАЁЯСе");
    println!("ЁЯОк р╣Ар╕Хр╕гр╕╡р╕вр╕бр╕Юр╕Ър╕Бр╕▒р╕Ър╕Бр╕▓р╕гр╣Бр╕Вр╣Ир╕Зр╕Вр╕▒р╕Щр╕кр╣Ир╕Зр╕Ир╕Фр╕лр╕бр╕▓р╕вр╕кр╕╕р╕Фр╕бр╕▒р╕Щр╕кр╣М! 3 р╕Чр╕╡р╕б 1 р╣Ар╕Ыр╣Йр╕▓р╕лр╕бр╕▓р╕в! ЁЯПЖ");

    let (tx, mut rx) = mpsc::channel::<String>(20); // р╕Бр╕ер╣Ир╕нр╕Зр╕Ир╕Фр╕лр╕бр╕▓р╕вр╕вр╕▒р╕Бр╕йр╣Мр╕Вр╕Щр╕▓р╕Ф 20 р╣Гр╕Ъ! ЁЯУоЁЯПв

    // р╕кр╕гр╣Йр╕▓р╕З multiple producers - р╣Ар╕гр╕╡р╕вр╕Бр╕Чр╕╡р╕бр╕Ър╕╕р╕гр╕╕р╕йр╣Др╕Ыр╕гр╕йр╕Ур╕╡р╕вр╣М! ЁЯСе
    let mut producers = Vec::new();
    println!("ЁЯОп р╣Ар╕гр╕╡р╕вр╕Бр╕Чр╕╡р╕бр╕Ър╕╕р╕гр╕╕р╕йр╣Др╕Ыр╕гр╕йр╕Ур╕╡р╕вр╣Мр╕Чр╕▒р╣Йр╕З 3 р╕Чр╕╡р╕б! р╕Юр╕гр╣Йр╕нр╕бр╣Бр╕Вр╣Ир╕Зр╕Вр╕▒р╕Щ! ЁЯПБ");

    for i in 1..=3 {
        let tx_clone = tx.clone();
        let producer = tokio::spawn(async move {
            println!("ЁЯСитАНЁЯТ╝ [р╕Чр╕╡р╕б{i}] р╕Ър╕╕р╕гр╕╕р╕йр╣Др╕Ыр╕гр╕йр╕Ур╕╡р╕вр╣Мр╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕кр╕Щр╕▓р╕б! р╕Юр╕гр╣Йр╕нр╕бр╕кр╣Ир╕Зр╕Ир╕Фр╕лр╕бр╕▓р╕в 3 р╕Йр╕Ър╕▒р╕Ъ! ЁЯПГтАНтЩВя╕ПЁЯТи");
            for j in 1..=3 {
                let message = format!("ЁЯОБ [р╕Чр╕╡р╕б{i}] р╕Ир╕Фр╕лр╕бр╕▓р╕вр╕Юр╕┤р╣Ар╕ир╕й #{j} (р╕кр╣Ир╕Зр╕Фр╣Йр╕зр╕вр╣Гр╕Ир╕гр╕▒р╕Б! ЁЯТЭ)");
                println!("ЁЯУдЁЯПГтАНтЩВя╕П [р╕Чр╕╡р╕б{i}] р╕зр╕┤р╣Ир╕Зр╕кр╣Ир╕З: {message}");

                if tx_clone.send(message).await.is_err() {
                    println!("тЭМЁЯШ▒ [р╕Чр╕╡р╕б{i}] р╣Вр╕нр╣Кр╕░р╣Вр╕н! р╕кр╣Ир╕Зр╣Др╕бр╣Ир╣Др╕Фр╣Й! (р╕нр╕▓р╕Ир╕Ир╕░р╣Ар╕лр╕Щр╕╖р╣Ир╕нр╕вр╣Ар╕Бр╕┤р╕Щр╣Др╕Ы!) ЁЯТж");
                    break;
                }

                sleep(Duration::from_millis(200 + i * 100)).await; // р╣Бр╕Хр╣Ир╕ер╕░р╕Чр╕╡р╕бр╕бр╕╡р╕Ир╕▒р╕Зр╕лр╕зр╕░р╕Хр╣Ир╕▓р╕Зр╕Бр╕▒р╕Щ! ЁЯО╡
            }
            println!("ЁЯУдЁЯПЖ [р╕Чр╕╡р╕б{i}] р╕Ър╕╕р╕гр╕╕р╕йр╣Др╕Ыр╕гр╕йр╕Ур╕╡р╕вр╣Мр╣Ар╕кр╕гр╣Зр╕Ир╕ар╕▓р╕гр╕Бр╕┤р╕И! (р╣Др╕Фр╣Йр╣Вр╕Ър╕Щр╕▒р╕к!) ЁЯТ░тЬи");
        });
        producers.push(producer);
    }

    // р╕Ыр╕┤р╕Ф original sender - р╕Ыр╕┤р╕Фр╕кр╕│р╕Щр╕▒р╕Бр╕Зр╕▓р╕Щр╣Гр╕лр╕Нр╣И! ЁЯПвЁЯФТ
    drop(tx);
    println!("ЁЯПвЁЯФТ р╕Ыр╕┤р╕Фр╕кр╕│р╕Щр╕▒р╕Бр╕Зр╕▓р╕Щр╣Гр╕лр╕Нр╣И! р╣Гр╕лр╣Йр╕Чр╕╡р╕бр╕ар╕▓р╕Др╕кр╕Щр╕▓р╕бр╕Чр╕│р╕Зр╕▓р╕Щр╕Хр╣Ир╕н!");

    // Consumer task - р╕Ьр╕╣р╣Йр╕гр╕▒р╕Ър╕Ир╕Фр╕лр╕бр╕▓р╕вр╕Лр╕╣р╣Ар╕Ыр╕нр╕гр╣М! ЁЯСйтАНЁЯТ╝ЁЯж╕тАНтЩАя╕П
    let consumer = tokio::spawn(async move {
        println!("ЁЯСйтАНЁЯТ╝ЁЯж╕тАНтЩАя╕П р╕Ьр╕╣р╣Йр╕гр╕▒р╕Ър╕Ир╕Фр╕лр╕бр╕▓р╕вр╕Лр╕╣р╣Ар╕Ыр╕нр╕гр╣Мр╕Юр╕гр╣Йр╕нр╕бр╣Бр╕ер╣Йр╕з! р╕гр╕нр╕гр╕▒р╕Ър╕Ир╕Фр╕лр╕бр╕▓р╕вр╕Ир╕▓р╕Бр╕Чр╕╕р╕Бр╕Чр╕╡р╕б! ЁЯУмтЪб");
        let mut count = 0;
        while let Some(message) = rx.recv().await {
            count += 1;
            println!("ЁЯУеЁЯОЙ [р╕гр╕▒р╕Ър╕Чр╕╡р╣И {count}] р╣Др╕Фр╣Йр╕Ир╕Фр╕лр╕бр╕▓р╕в: {message} (р╕нр╣Ир╕▓р╕Щр╕Фр╣Йр╕зр╕вр╕Др╕зр╕▓р╕бр╕Ыр╕ер╕▓р╕Ър╕Ыр╕ер╕╖р╣Йр╕б!) ЁЯШН");
            sleep(Duration::from_millis(50)).await; // р╕нр╣Ир╕▓р╕Щр╕нр╕вр╣Ир╕▓р╕Зр╕гр╕зр╕Фр╣Ар╕гр╣Зр╕зр╣Бр╕Хр╣Ир╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф! тЪбЁЯСУ
        }
        println!("ЁЯУеЁЯПЕ р╕Ьр╕╣р╣Йр╕гр╕▒р╕Ър╕Ир╕Фр╕лр╕бр╕▓р╕вр╕Лр╕╣р╣Ар╕Ыр╕нр╕гр╣Мр╣Ар╕кр╕гр╣Зр╕Ир╕Зр╕▓р╕Щ! р╕гр╕▒р╕Ър╕Др╕гр╕Ъ {count} р╕Йр╕Ър╕▒р╕Ъ! (р╕Чр╕╕р╕Бр╕Йр╕Ър╕▒р╕Ър╕бр╕╡р╕Др╣Ир╕▓!) ЁЯТО");
    });

    // р╕гр╕нр╣Гр╕лр╣Йр╕Чр╕╕р╕Б tasks р╣Ар╕кр╕гр╣Зр╕И - р╕гр╕нр╣Гр╕лр╣Йр╕Бр╕▓р╕гр╣Бр╕Вр╣Ир╕Зр╕Вр╕▒р╕Щр╕Ир╕Ъ! ЁЯПБ
    println!("тП│ЁЯПБ р╕гр╕нр╣Гр╕лр╣Йр╕Бр╕▓р╕гр╣Бр╕Вр╣Ир╕Зр╕Вр╕▒р╕Щр╕кр╣Ир╕Зр╕Ир╕Фр╕лр╕бр╕▓р╕вр╕Ир╕Ъ... (р╣Гр╕Др╕гр╕Ир╕░р╣Ар╕Ыр╣Зр╕Щр╣Бр╕Кр╕бр╕Ыр╣М?) ЁЯПЖ");
    for (i, producer) in producers.into_iter().enumerate() {
        let _ = producer.await;
        println!("тЬЕ р╕Чр╕╡р╕б{} р╣Ар╕Вр╣Йр╕▓р╣Ар╕кр╣Йр╕Щр╕Кр╕▒р╕вр╣Бр╕ер╣Йр╕з! ЁЯПГтАНтЩВя╕ПЁЯПБ", i + 1);
    }
    let _ = consumer.await;
    println!("ЁЯОКЁЯПЖ р╕Бр╕▓р╕гр╣Бр╕Вр╣Ир╕Зр╕Вр╕▒р╕Щр╕кр╣Ир╕Зр╕Ир╕Фр╕лр╕бр╕▓р╕вр╣Ар╕кр╕гр╣Зр╕Ир╕кр╕┤р╣Йр╕Щ! р╕Чр╕╕р╕Бр╕Чр╕╡р╕бр╣Ар╕Ыр╣Зр╕Щр╣Бр╕Кр╕бр╕Ыр╣М! (р╣Др╕бр╣Ир╕бр╕╡р╣Гр╕Др╕гр╣Бр╕Юр╣Й!) ЁЯМИтЬи");
}

/// р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╣Гр╕Кр╣Й oneshot channels - р╕Ир╕Фр╕лр╕бр╕▓р╕вр╕Фр╣Ир╕зр╕Щр╕Юр╕┤р╣Ар╕ир╕й! ЁЯОптЪб
pub async fn oneshot_example() {
    println!("\nЁЯОптЪб === р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З Oneshot Channels: р╕Ир╕Фр╕лр╕бр╕▓р╕вр╕Фр╣Ир╕зр╕Щр╕Юр╕┤р╣Ар╕ир╕й! === тЪбЁЯОп");
    println!("ЁЯЪА р╣Ар╕Хр╕гр╕╡р╕вр╕бр╕Юр╕Ър╕Бр╕▒р╕Ър╕Ър╕гр╕┤р╕Бр╕▓р╕гр╕Ир╕Фр╕лр╕бр╕▓р╕вр╕Фр╣Ир╕зр╕Щр╕Чр╕╡р╣Ир╣Ар╕гр╣Зр╕зр╕Чр╕╡р╣Ир╕кр╕╕р╕Фр╣Гр╕Щр╕Ир╕▒р╕Бр╕гр╕зр╕▓р╕е! (р╕кр╣Ир╕Зр╕Др╕гр╕▒р╣Йр╕Зр╣Ар╕Фр╕╡р╕вр╕з р╕Ир╕Ъ!) ЁЯТл");

    let (tx, rx) = oneshot::channel::<String>(); // р╕Чр╣Ир╕нр╕кр╣Ир╕Зр╕Ир╕Фр╕лр╕бр╕▓р╕вр╕Фр╣Ир╕зр╕Щр╕Юр╕┤р╣Ар╕ир╕й! ЁЯЪАЁЯУо

    // Task р╕Чр╕╡р╣Ир╕кр╣Ир╕Зр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М - р╕Щр╕▒р╕Бр╕зр╕┤р╕Чр╕вр╕▓р╕ир╕▓р╕кр╕Хр╕гр╣Мр╕Ър╣Йр╕▓! ЁЯСитАНЁЯФмЁЯзк
    let sender_task = tokio::spawn(async move {
        println!("ЁЯСитАНЁЯФмЁЯзк р╕Щр╕▒р╕Бр╕зр╕┤р╕Чр╕вр╕▓р╕ир╕▓р╕кр╕Хр╕гр╣Мр╣Ар╕гр╕┤р╣Ир╕бр╕Чр╕│р╕Бр╕▓р╕гр╕Чр╕Фр╕ер╕нр╕З! (р╕кр╕╣р╕Хр╕гр╕ер╕▒р╕Ър╕Бр╕│р╕ер╕▒р╕Зр╕бр╕▓!) тЪЧя╕ПтЬи");
        println!("ЁЯФДЁЯТл р╕Бр╕│р╕ер╕▒р╕Зр╕Ыр╕гр╕░р╕бр╕зр╕ер╕Ьр╕ер╕кр╕╣р╕Хр╕гр╕бр╕лр╕▒р╕ир╕Ир╕гр╕гр╕вр╣М... (р╕нр╕вр╣Ир╕▓р╣Ар╕Юр╕┤р╣Ир╕Зр╣Др╕Ыр╣Др╕лр╕Щ!) ЁЯОн");
        sleep(Duration::from_millis(500)).await; // р╕Чр╕│р╕Бр╕▓р╕гр╕Чр╕Фр╕ер╕нр╕Зр╕нр╕вр╣Ир╕▓р╕Зр╕гр╕░р╕бр╕▒р╕Фр╕гр╕░р╕зр╕▒р╕З! ЁЯзм

        let result = "ЁЯОЙ р╕кр╕╣р╕Хр╕гр╕бр╕лр╕▒р╕ир╕Ир╕гр╕гр╕вр╣Мр╕кр╕│р╣Ар╕гр╣Зр╕И! р╕Др╕зр╕▓р╕бр╕ер╕▒р╕Ър╕Вр╕нр╕Зр╕Ир╕▒р╕Бр╕гр╕зр╕▓р╕е = 42! ЁЯММтЬи".to_string();
        println!("ЁЯУдЁЯЪА р╕кр╣Ир╕Зр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕Фр╣Ир╕зр╕Щр╕Юр╕┤р╣Ар╕ир╕й: {result}");

        if tx.send(result).is_err() {
            println!("тЭМЁЯТе р╣Вр╕нр╣Кр╕░р╣Вр╕н! р╕кр╣Ир╕Зр╣Др╕бр╣Ир╣Др╕Фр╣Й! (р╕нр╕▓р╕Ир╕Ир╕░р╕бр╕╡р╕Др╕Щр╕Фр╕▒р╕Бр╕Яр╕▒р╕З!) ЁЯХ╡я╕ПтАНтЩВя╕П");
        } else {
            println!("тЬЕЁЯОК р╕кр╣Ир╕Зр╕кр╕│р╣Ар╕гр╣Зр╕И! р╕Ир╕Фр╕лр╕бр╕▓р╕вр╕Фр╣Ир╕зр╕Щр╕нр╕нр╕Бр╣Ар╕Фр╕┤р╕Щр╕Чр╕▓р╕Зр╣Бр╕ер╣Йр╕з! ЁЯПГтАНтЩВя╕ПЁЯТи");
        }
    });

    // Task р╕Чр╕╡р╣Ир╕гр╕нр╕гр╕▒р╕Ър╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М - р╕Щр╕▒р╕Бр╕кр╕╖р╕Ър╕гр╕нр╕Др╕│р╕Хр╕нр╕Ъ! ЁЯХ╡я╕ПтАНтЩАя╕ПЁЯФН
    let receiver_task = tokio::spawn(async move {
        println!("ЁЯХ╡я╕ПтАНтЩАя╕ПЁЯФН р╕Щр╕▒р╕Бр╕кр╕╖р╕Ър╕Юр╕гр╣Йр╕нр╕бр╣Бр╕ер╣Йр╕з! р╕гр╕нр╕гр╕▒р╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕ер╕▒р╕Ър╕кр╕╕р╕Фр╕вр╕нр╕Ф... (р╕Хр╕╖р╣Ир╕Щр╣Ар╕Хр╣Йр╕Щр╕бр╕▓р╕Б!) ЁЯТУ");
        println!("тП│ЁЯСА р╕Ир╣Йр╕нр╕Зр╕бр╕нр╕Зр╕Бр╕ер╣Ир╕нр╕Зр╕Ир╕Фр╕лр╕бр╕▓р╕вр╕Фр╣Ир╕зр╕Щ... (р╕лр╕▒р╕зр╣Гр╕Ир╣Ар╕Хр╣Йр╕Щр╣Бр╕гр╕З!) ЁЯТЧ");

        if let Ok(result) = rx.await {
            println!("ЁЯУеЁЯОЙ р╕гр╕▒р╕Ър╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕кр╕│р╣Ар╕гр╣Зр╕И! {result}");
            println!("ЁЯдпЁЯТл р╕Хр╕░р╕ер╕╢р╕З! р╕Др╕зр╕▓р╕бр╕ер╕▒р╕Ър╕Вр╕нр╕Зр╕Ир╕▒р╕Бр╕гр╕зр╕▓р╕ер╕Цр╕╣р╕Бр╣Ар╕Ыр╕┤р╕Фр╣Ар╕Ьр╕вр╣Бр╕ер╣Йр╕з! (р╕Кр╕╡р╕зр╕┤р╕Хр╕бр╕╡р╕Др╕зр╕▓р╕бр╕лр╕бр╕▓р╕в!) ЁЯМЯ");
        } else {
            println!("тЭМЁЯШ▒ р╣Др╕бр╣Ир╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М! (р╕нр╕▓р╕Ир╕Ир╕░р╕Цр╕╣р╕Бр╕Фр╕▒р╕Бр╕Ир╕▒р╕Ъ!) ЁЯЪи");
            println!("ЁЯТФ р╕Др╕зр╕▓р╕бр╕ер╕▒р╕Ър╕Вр╕нр╕Зр╕Ир╕▒р╕Бр╕гр╕зр╕▓р╕ер╕вр╕▒р╕Зр╕Др╕Зр╣Ар╕Ыр╣Зр╕Щр╕Ыр╕гр╕┤р╕ир╕Щр╕▓... ЁЯММтЭУ");
        }
    });

    println!("тП│ЁЯОн р╕гр╕нр╣Гр╕лр╣Йр╕Бр╕▓р╕гр╕Чр╕Фр╕ер╕нр╕Зр╣Бр╕ер╕░р╕Бр╕▓р╕гр╕кр╕╖р╕Ър╕кр╕зр╕Щр╣Ар╕кр╕гр╣Зр╕Ир╕кр╕┤р╣Йр╕Щ... (р╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╕ир╕▓р╕кр╕Хр╕гр╣Мр╕Бр╕│р╕ер╕▒р╕Зр╣Ар╕Бр╕┤р╕Фр╕Вр╕╢р╣Йр╕Щ!) ЁЯУЪтЬи");
    let _ = tokio::join!(sender_task, receiver_task);
    println!("ЁЯОКЁЯПЖ р╕ар╕▓р╕гр╕Бр╕┤р╕Ир╕Ир╕Фр╕лр╕бр╕▓р╕вр╕Фр╣Ир╕зр╕Щр╕Юр╕┤р╣Ар╕ир╕йр╣Ар╕кр╕гр╣Зр╕Ир╕кр╕┤р╣Йр╕Щ! р╕Др╕зр╕▓р╕бр╕Ир╕гр╕┤р╕Зр╕Цр╕╣р╕Бр╣Ар╕Ыр╕┤р╕Фр╣Ар╕Ьр╕вр╣Бр╕ер╣Йр╕з! ЁЯМИЁЯФо");
}

/// р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╣Гр╕Кр╣Й broadcast channels - р╕лр╕нр╕Бр╕гр╕░р╕Ир╕▓р╕вр╕Вр╣Ир╕▓р╕зр╣Бр╕лр╣Ир╕Зр╕нр╕Щр╕▓р╕Др╕Х! ЁЯУвтЪб
pub async fn broadcast_example() {
    println!("\nЁЯУвЁЯМЯ === р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З Broadcast Channels: р╕лр╕нр╕Бр╕гр╕░р╕Ир╕▓р╕вр╕Вр╣Ир╕▓р╕зр╣Бр╕лр╣Ир╕Зр╕нр╕Щр╕▓р╕Др╕Х! === ЁЯМЯЁЯУв");
    println!("ЁЯУ╗ р╣Ар╕Хр╕гр╕╡р╕вр╕бр╕Юр╕Ър╕Бр╕▒р╕Ър╕кр╕Цр╕▓р╕Щр╕╡р╕зр╕┤р╕Чр╕вр╕╕р╕Чр╕╡р╣Ир╕кр╣Ир╕Зр╕Вр╣Ир╕▓р╕зр╣Др╕Ыр╕Чр╕▒р╣Ир╕зр╕Ир╕▒р╕Бр╕гр╕зр╕▓р╕е! (р╕Чр╕╕р╕Бр╕Др╕Щр╣Др╕Фр╣Йр╕Яр╕▒р╕Зр╕Юр╕гр╣Йр╕нр╕бр╕Бр╕▒р╕Щ!) ЁЯММтЬи");

    let (tx, _) = broadcast::channel::<String>(10); // р╣Ар╕Др╕гр╕╖р╣Ир╕нр╕Зр╕кр╣Ир╕Зр╕кр╕▒р╕Нр╕Нр╕▓р╕Ур╣Бр╕гр╕Зр╕кр╕╣р╕З! ЁЯУбЁЯФЛ

    // р╕кр╕гр╣Йр╕▓р╕З multiple subscribers - р╕Чр╕╡р╕бр╕Ьр╕╣р╣Йр╕Яр╕▒р╕Зр╕Вр╣Ир╕▓р╕зр╕бр╕╖р╕нр╕нр╕▓р╕Кр╕╡р╕Ю! ЁЯСВЁЯОз
    let mut subscribers = Vec::new();
    println!("ЁЯОз р╣Ар╕гр╕╡р╕вр╕Бр╕Чр╕╡р╕бр╕Ьр╕╣р╣Йр╕Яр╕▒р╕Зр╕Вр╣Ир╕▓р╕зр╕бр╕╖р╕нр╕нр╕▓р╕Кр╕╡р╕Ю! р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф 3 р╕Др╕Щ! ЁЯСеЁЯУ╗");

    for i in 1..=3 {
        let mut rx = tx.subscribe();
        let subscriber = tokio::spawn(async move {
            println!("ЁЯСВЁЯОз [р╕Ьр╕╣р╣Йр╕Яр╕▒р╕З{i}] р╣Ар╕Ыр╕┤р╕Фр╕зр╕┤р╕Чр╕вр╕╕р╣Бр╕ер╣Йр╕з! р╕Юр╕гр╣Йр╕нр╕бр╕Яр╕▒р╕Зр╕Вр╣Ир╕▓р╕зр╕кр╕▓р╕г! (р╕лр╕╣р╣Бр╕лр╕ер╕бр╕бр╕▓р╕Б!) ЁЯж╗тЬи");

            let mut news_count = 0;
            while let Ok(message) = rx.recv().await {
                news_count += 1;
                println!("ЁЯУеЁЯУ╗ [р╕Ьр╕╣р╣Йр╕Яр╕▒р╕З{i}] р╣Др╕Фр╣Йр╕вр╕┤р╕Щр╕Вр╣Ир╕▓р╕зр╕Чр╕╡р╣И {news_count}: {message} (р╕Ир╕Фр╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Др╕зр╣Йр╣Бр╕ер╣Йр╕з!) ЁЯУЭ");
                sleep(Duration::from_millis(100)).await; // р╕вр╣Ир╕нр╕вр╕Вр╣Ир╕▓р╕зр╣Гр╕Щр╣Гр╕И! ЁЯзаЁЯТн
            }

            println!("ЁЯСВЁЯФЗ [р╕Ьр╕╣р╣Йр╕Яр╕▒р╕З{i}] р╕Ыр╕┤р╕Фр╕зр╕┤р╕Чр╕вр╕╕р╣Бр╕ер╣Йр╕з! р╕Яр╕▒р╕Зр╕Вр╣Ир╕▓р╕зр╕Др╕гр╕Ъ {news_count} р╕Вр╣Ир╕▓р╕з! (р╕лр╕╣р╕Юр╕нр╣Бр╕ер╣Йр╕з!) ЁЯОзЁЯТд");
        });
        subscribers.push(subscriber);
    }

    // Broadcaster task - р╕Фр╕╡р╣Ар╕Ир╕Вр╣Ир╕▓р╕зр╕кр╕▓р╕гр╣Бр╕лр╣Ир╕Зр╕нр╕Щр╕▓р╕Др╕Х! ЁЯОЩя╕ПЁЯСитАНЁЯТ╝
    let broadcaster = tokio::spawn(async move {
        println!("ЁЯОЩя╕ПЁЯСитАНЁЯТ╝ р╕Фр╕╡р╣Ар╕Ир╕Вр╣Ир╕▓р╕зр╕кр╕▓р╕гр╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕лр╣Йр╕нр╕Зр╕нр╕нр╕Бр╕нр╕▓р╕Бр╕▓р╕и! р╣Ар╕Хр╕гр╕╡р╕вр╕бр╕кр╣Ир╕Зр╕Вр╣Ир╕▓р╕зр╕кр╕│р╕Др╕▒р╕Н 5 р╕Вр╣Ир╕▓р╕з! ЁЯУ║тЬи");
        for i in 1..=5 {
            let message = format!("ЁЯМЯ р╕Вр╣Ир╕▓р╕зр╕Фр╣Ир╕зр╕Щр╕Чр╕╡р╣И {i}: р╕бр╕╡р╕Бр╕▓р╕гр╕Др╣Йр╕Щр╕Юр╕Ър╕Др╕зр╕▓р╕бр╕ер╕▒р╕Ър╕Вр╕нр╕Зр╕Ир╕▒р╕Бр╕гр╕зр╕▓р╕е! (р╕Хр╕╖р╣Ир╕Щр╣Ар╕Хр╣Йр╕Щр╕бр╕▓р╕Б!) ЁЯЪАЁЯФН");
            println!("ЁЯУвЁЯОЩя╕П Broadcast р╕Вр╣Ир╕▓р╕зр╕кр╕│р╕Др╕▒р╕Н: {message}");

            if tx.send(message).is_err() {
                println!("тЭМЁЯУ╗ р╣Вр╕нр╣Кр╕░р╣Вр╕н! р╣Др╕бр╣Ир╕бр╕╡р╣Гр╕Др╕гр╕Яр╕▒р╕З! (р╕нр╕▓р╕Ир╕Ир╕░р╣Др╕Яр╕Яр╣Йр╕▓р╕Фр╕▒р╕Ъ!) тЪбЁЯТФ");
                break;
            }

            sleep(Duration::from_millis(400)).await; // р╣Ар╕Хр╕гр╕╡р╕вр╕бр╕Вр╣Ир╕▓р╕зр╕Хр╣Ир╕нр╣Др╕Ы! ЁЯУ░тЬНя╕П
        }
        println!("ЁЯУвЁЯОЙ р╕Фр╕╡р╣Ар╕Ир╕Вр╣Ир╕▓р╕зр╕кр╕▓р╕гр╣Ар╕кр╕гр╣Зр╕Ир╕Зр╕▓р╕Щ! р╕кр╣Ир╕Зр╕Вр╣Ир╕▓р╕зр╕Др╕гр╕Ър╣Бр╕ер╣Йр╕з! (р╣Др╕Фр╣Йр╣Ар╕гр╕Хр╕Хр╕┤р╣Йр╕Зр╕кр╕╣р╕З!) ЁЯУКЁЯПЖ");
    });

    // р╕гр╕нр╣Гр╕лр╣Й broadcaster р╣Ар╕кр╕гр╣Зр╕Ир╕Бр╣Ир╕нр╕Щ - р╕гр╕нр╣Гр╕лр╣Йр╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Ир╕Ъ! ЁЯУ║
    println!("тП│ЁЯУ║ р╕гр╕нр╣Гр╕лр╣Йр╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Вр╣Ир╕▓р╕зр╕Ир╕Ъ... (р╕нр╕вр╣Ир╕▓р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕Кр╣Ир╕нр╕З!) ЁЯУ╗");
    let _ = broadcaster.await;

    // р╕гр╕нр╣Гр╕лр╣Й subscribers р╕Ыр╕гр╕░р╕бр╕зр╕ер╕Ьр╕ер╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Чр╕╡р╣Ир╣Ар╕лр╕ер╕╖р╕н - р╣Гр╕лр╣Йр╣Ар╕зр╕ер╕▓р╕вр╣Ир╕нр╕вр╕Вр╣Ир╕▓р╕з! ЁЯза
    println!("ЁЯТн р╣Гр╕лр╣Йр╣Ар╕зр╕ер╕▓р╕Ьр╕╣р╣Йр╕Яр╕▒р╕Зр╕вр╣Ир╕нр╕вр╕Вр╣Ир╕▓р╕зр╣Гр╕Щр╣Гр╕И... (р╕Вр╣Ир╕▓р╕зр╕кр╕│р╕Др╕▒р╕Нр╕Хр╣Йр╕нр╕Зр╕Др╕┤р╕Фр╣Гр╕лр╣Йр╕Фр╕╡!) ЁЯдФ");
    sleep(Duration::from_millis(500)).await;

    // р╕гр╕нр╣Гр╕лр╣Йр╕Чр╕╕р╕Б subscribers р╣Ар╕кр╕гр╣Зр╕И - р╕гр╕нр╣Гр╕лр╣Йр╕Чр╕╕р╕Бр╕Др╕Щр╕Ыр╕┤р╕Фр╕зр╕┤р╕Чр╕вр╕╕! ЁЯУ╗
    println!("ЁЯФЗ р╕гр╕нр╣Гр╕лр╣Йр╕Чр╕╕р╕Бр╕Др╕Щр╕Ыр╕┤р╕Фр╕зр╕┤р╕Чр╕вр╕╕... (р╕Ир╕Ър╕гр╕▓р╕вр╕Бр╕▓р╕гр╣Бр╕ер╣Йр╕з!) ЁЯУ║");
    for (i, subscriber) in subscribers.into_iter().enumerate() {
        let _ = subscriber.await;
        println!("тЬЕ р╕Ьр╕╣р╣Йр╕Яр╕▒р╕З{} р╕Ыр╕┤р╕Фр╕зр╕┤р╕Чр╕вр╕╕р╣Бр╕ер╣Йр╕з! ЁЯУ╗ЁЯТд", i + 1);
    }
    println!("ЁЯОКЁЯУ╗ р╕кр╕Цр╕▓р╕Щр╕╡р╕зр╕┤р╕Чр╕вр╕╕р╣Бр╕лр╣Ир╕Зр╕нр╕Щр╕▓р╕Др╕Хр╕Ыр╕┤р╕Фр╕Бр╕▓р╕гр╕нр╕нр╕Бр╕нр╕▓р╕Бр╕▓р╕и! р╕Чр╕╕р╕Бр╕Др╕Щр╣Др╕Фр╣Йр╕Вр╣Ир╕▓р╕зр╕Др╕гр╕Ър╣Бр╕ер╣Йр╕з! ЁЯМИтЬи");
}

/// р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╣Гр╕Кр╣Й channels р╕кр╕│р╕лр╕гр╕▒р╕Ъ coordination - р╕Ьр╕╣р╣Йр╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Чр╕╡р╕бр╣Бр╕лр╣Ир╕Зр╕нр╕Щр╕▓р╕Др╕Х! ЁЯдЭтЪб
pub async fn coordination_example() {
    println!("\nЁЯдЭЁЯОп === р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕З Task Coordination: р╕Ьр╕╣р╣Йр╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Чр╕╡р╕бр╣Бр╕лр╣Ир╕Зр╕нр╕Щр╕▓р╕Др╕Х! === ЁЯОпЁЯдЭ");
    println!("ЁЯСФ р╣Ар╕Хр╕гр╕╡р╕вр╕бр╕Юр╕Ър╕Бр╕▒р╕Ър╕Бр╕▓р╕гр╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Чр╕╡р╕бр╕Зр╕▓р╕Щр╕Чр╕╡р╣Ир╕ер╕Зр╕Хр╕▒р╕зр╕Чр╕╡р╣Ир╕кр╕╕р╕Ф! (р╣Др╕бр╣Ир╕бр╕╡р╣Гр╕Др╕гр╕Зр╕▓р╕Щр╕ер╣Ир╕▓р╕Кр╣Йр╕▓!) ЁЯПвтЬи");

    let (start_tx, _start_rx) = broadcast::channel::<()>(1); // р╕Щр╕Бр╕лр╕зр╕╡р╕Фр╣Ар╕гр╕┤р╣Ир╕бр╕Зр╕▓р╕Щ! ЁЯУп
    let (done_tx, mut done_rx) = mpsc::channel::<String>(10); // р╕Бр╕ер╣Ир╕нр╕Зр╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕Ьр╕е! ЁЯУЛ

    // р╕кр╕гр╣Йр╕▓р╕З worker tasks - р╣Ар╕гр╕╡р╕вр╕Бр╕Чр╕╡р╕бр╕Зр╕▓р╕Щр╕бр╕╖р╕нр╕нр╕▓р╕Кр╕╡р╕Ю! ЁЯС╖тАНтЩВя╕ПЁЯС╖тАНтЩАя╕П
    let mut workers = Vec::new();
    println!("ЁЯСе р╣Ар╕гр╕╡р╕вр╕Бр╕Чр╕╡р╕бр╕Зр╕▓р╕Щр╕бр╕╖р╕нр╕нр╕▓р╕Кр╕╡р╕Ю! р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф 3 р╕Др╕Щ! р╕Юр╕гр╣Йр╕нр╕бр╕гр╕▒р╕Ър╕бр╕╖р╕нр╕Чр╕╕р╕Бр╕ар╕▓р╕гр╕Бр╕┤р╕И! ЁЯТк");

    for i in 1..=3 {
        let mut start_signal = start_tx.subscribe();
        let done_sender = done_tx.clone();

        let worker = tokio::spawn(async move {
            println!("ЁЯС╖тАНтЩВя╕П [р╕Юр╕Щр╕▒р╕Бр╕Зр╕▓р╕Щ{i}] р╕бр╕▓р╕Цр╕╢р╕Зр╕Чр╕╡р╣Ир╕Чр╕│р╕Зр╕▓р╕Щр╣Бр╕ер╣Йр╕з! р╕гр╕нр╕кр╕▒р╕Нр╕Нр╕▓р╕Ур╣Ар╕гр╕┤р╣Ир╕бр╕Зр╕▓р╕Щ... (р╕Бр╕▓р╣Бр╕Яр╕Юр╕гр╣Йр╕нр╕б!) тШХЁЯСА");

            // р╕гр╕нр╕кр╕▒р╕Нр╕Нр╕▓р╕Ур╣Ар╕гр╕┤р╣Ир╕бр╕Зр╕▓р╕Щ - р╕гр╕нр╣Ар╕кр╕╡р╕вр╕Зр╕Щр╕Бр╕лр╕зр╕╡р╕Ф! ЁЯУп
            if start_signal.recv().await.is_ok() {
                println!("ЁЯЪАЁЯТи [р╕Юр╕Щр╕▒р╕Бр╕Зр╕▓р╕Щ{i}] р╣Др╕Фр╣Йр╕вр╕┤р╕Щр╕Щр╕Бр╕лр╕зр╕╡р╕Ф! р╣Ар╕гр╕┤р╣Ир╕бр╕Чр╕│р╕Зр╕▓р╕Щр╣Ар╕Хр╣Зр╕бр╕кр╕Ыр╕╡р╕Ф! (р╣Вр╕лр╕бр╕Фр╣Ар╕Чр╕нр╕гр╣Мр╣Вр╕Ъ!) тЪб");

                // р╕Ир╕│р╕ер╕нр╕Зр╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щ - р╕Чр╕│р╕Зр╕▓р╕Щр╕нр╕вр╣Ир╕▓р╕Зр╕бр╕╡р╕Др╕зр╕▓р╕бр╕кр╕╕р╕В! ЁЯШК
                let work_time = 200 + i * 100;
                println!("тП│ЁЯФз [р╕Юр╕Щр╕▒р╕Бр╕Зр╕▓р╕Щ{i}] р╕Бр╕│р╕ер╕▒р╕Зр╕Чр╕│р╕Зр╕▓р╕Щ... р╕Др╕▓р╕Фр╕зр╣Ир╕▓р╣Гр╕Кр╣Йр╣Ар╕зр╕ер╕▓ {work_time}ms (р╕Чр╕│р╕Фр╣Йр╕зр╕вр╣Гр╕Ир╕гр╕▒р╕Б!) ЁЯТЭ");
                sleep(Duration::from_millis(work_time)).await;

                let result = format!("ЁЯПЖ р╕Юр╕Щр╕▒р╕Бр╕Зр╕▓р╕Щ{i} р╕Чр╕│р╕Зр╕▓р╕Щр╣Ар╕кр╕гр╣Зр╕Ир╣Бр╕ер╣Йр╕з! (р╣Гр╕Кр╣Йр╣Ар╕зр╕ер╕▓ {work_time}ms) р╕Ьр╕ер╕Зр╕▓р╕Щр╕Др╕╕р╕Ур╕ар╕▓р╕Юр╣Ар╕вр╕╡р╣Ир╕вр╕б! тЬи");
                println!("тЬЕЁЯОЙ [р╕Юр╕Щр╕▒р╕Бр╕Зр╕▓р╕Щ{i}] {result}");

                // р╕кр╣Ир╕Зр╕кр╕▒р╕Нр╕Нр╕▓р╕Ур╕зр╣Ир╕▓р╣Ар╕кр╕гр╣Зр╕Ир╣Бр╕ер╣Йр╕з - р╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕Ьр╕ер╕Зр╕▓р╕Щ! ЁЯУК
                if done_sender.send(result).await.is_err() {
                    println!("тЭМЁЯУЛ [р╕Юр╕Щр╕▒р╕Бр╕Зр╕▓р╕Щ{i}] р╣Вр╕нр╣Кр╕░р╣Вр╕н! р╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕Ьр╕ер╣Др╕бр╣Ир╣Др╕Фр╣Й! (р╕нр╕▓р╕Ир╕Ир╕░р╕Ьр╕╣р╣Йр╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╣Др╕Ыр╕Бр╕┤р╕Щр╕Вр╣Йр╕▓р╕з!) ЁЯН╜я╕П");
                }
            }
        });

        workers.push(worker);
    }

    // р╕Ыр╕┤р╕Ф done_tx р╕Хр╣Йр╕Щр╕Йр╕Ър╕▒р╕Ъ - р╕Ьр╕╣р╣Йр╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Ыр╕┤р╕Фр╕Бр╕ер╣Ир╕нр╕Зр╕гр╕▓р╕вр╕Зр╕▓р╕Щ! ЁЯУЛЁЯФТ
    drop(done_tx);
    println!("ЁЯУЛЁЯФТ р╕Ьр╕╣р╣Йр╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Ыр╕┤р╕Фр╕Бр╕ер╣Ир╕нр╕Зр╕гр╕▓р╕вр╕Зр╕▓р╕Щр╣Бр╕ер╣Йр╕з! р╕гр╕нр╕гр╕▒р╕Ър╕Ьр╕ер╕Зр╕▓р╕Щр╕Ир╕▓р╕Бр╕Чр╕╡р╕б!");

    // р╕гр╕нр╕кр╕▒р╕Бр╕Др╕гр╕╣р╣Ир╣Бр╕ер╣Йр╕зр╕кр╣Ир╕Зр╕кр╕▒р╕Нр╕Нр╕▓р╕Ур╣Ар╕гр╕┤р╣Ир╕бр╕Зр╕▓р╕Щ - р╣Гр╕лр╣Йр╣Ар╕зр╕ер╕▓р╣Ар╕Хр╕гр╕╡р╕вр╕бр╕Хр╕▒р╕з! тП░
    println!("тП░ р╣Гр╕лр╣Йр╣Ар╕зр╕ер╕▓р╕Чр╕╡р╕бр╕Зр╕▓р╕Щр╣Ар╕Хр╕гр╕╡р╕вр╕бр╕Хр╕▒р╕з... (р╕Фр╕╖р╣Ир╕бр╕Бр╕▓р╣Бр╕Яр╕Бр╣Ир╕нр╕Щ!) тШХ");
    sleep(Duration::from_millis(500)).await;
    println!("ЁЯУгЁЯУп р╕Ьр╕╣р╣Йр╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╣Ар╕Ыр╣Ир╕▓р╕Щр╕Бр╕лр╕зр╕╡р╕Ф! р╣Ар╕гр╕┤р╣Ир╕бр╕Зр╕▓р╕Щр╣Др╕Фр╣Й! (р╕Чр╕╕р╕Бр╕Др╕Щр╕Юр╕гр╣Йр╕нр╕бр╣Бр╕ер╣Йр╕з!) ЁЯО║");
    let _ = start_tx.send(());

    // р╕гр╕нр╕гр╕▒р╕Ър╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕Ир╕▓р╕Б workers - р╕гр╕нр╕гр╕▒р╕Ър╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕Ьр╕ер╕Зр╕▓р╕Щ! ЁЯУК
    println!("ЁЯУКЁЯСА р╕Ьр╕╣р╣Йр╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕гр╕нр╕гр╕▒р╕Ър╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕Ьр╕ер╕Зр╕▓р╕Щ... (р╕Хр╕╖р╣Ир╕Щр╣Ар╕Хр╣Йр╕Щр╕бр╕▓р╕Б!) ЁЯТУ");
    let mut completed = 0;
    while let Some(result) = done_rx.recv().await {
        completed += 1;
        println!("ЁЯУКЁЯОЙ [р╕гр╕▓р╕вр╕Зр╕▓р╕Щр╕Чр╕╡р╣И {completed}] {result} (р╕ар╕╣р╕бр╕┤р╣Гр╕Ир╕бр╕▓р╕Б!) ЁЯе│");
    }

    // р╕гр╕нр╣Гр╕лр╣Йр╕Чр╕╕р╕Б workers р╣Ар╕кр╕гр╣Зр╕И - р╕гр╕нр╣Гр╕лр╣Йр╕Чр╕╕р╕Бр╕Др╕Щр╕Бр╕ер╕▒р╕Ър╕Ър╣Йр╕▓р╕Щ! ЁЯПа
    println!("тП│ЁЯПа р╕гр╕нр╣Гр╕лр╣Йр╕Чр╕╕р╕Бр╕Др╕Щр╣Ар╕Бр╣Зр╕Ър╕Вр╕нр╕Зр╕Бр╕ер╕▒р╕Ър╕Ър╣Йр╕▓р╕Щ... (р╕нр╕вр╣Ир╕▓р╕ер╕╖р╕бр╕Вр╕нр╕З!) ЁЯОТ");
    for (i, worker) in workers.into_iter().enumerate() {
        let _ = worker.await;
        println!("тЬЕЁЯЪк р╕Юр╕Щр╕▒р╕Бр╕Зр╕▓р╕Щ{} р╕Бр╕ер╕▒р╕Ър╕Ър╣Йр╕▓р╕Щр╣Бр╕ер╣Йр╕з! (р╕Вр╕▒р╕Ър╕гр╕Цр╕гр╕░р╕зр╕▒р╕Зр╕Щр╕░!) ЁЯЪЧЁЯТи", i + 1);
    }

    println!("ЁЯОЙЁЯПЖ р╕Чр╕╕р╕Бр╕Др╕Щр╣Ар╕кр╕гр╣Зр╕Ир╕Зр╕▓р╕Щр╣Бр╕ер╣Йр╕з! р╕Чр╕╡р╕бр╕Зр╕▓р╕Щр╕Чр╕╡р╣Ир╕вр╕нр╕Фр╣Ар╕вр╕╡р╣Ир╕вр╕б! (р╣Др╕Фр╣Йр╣Вр╕Ър╕Щр╕▒р╕кр╣Бр╕Щр╣Ир╕Щр╕нр╕Щ!) ЁЯТ░тЬи");
}

/// р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕гр╕зр╕бр╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф - р╣Ар╕Ыр╕┤р╕Фр╣Вр╕гр╕Зр╣Ар╕гр╕╡р╕вр╕Щр╕кр╕нр╕Щр╕Бр╕▓р╕гр╕кр╕╖р╣Ир╕нр╕кр╕▓р╕гр╣Бр╕лр╣Ир╕Зр╕нр╕Щр╕▓р╕Др╕Х! ЁЯОУЁЯУб
pub async fn run_channels_examples() {
    println!("\nЁЯОУЁЯУб === р╣Вр╕гр╕Зр╣Ар╕гр╕╡р╕вр╕Щр╕кр╕нр╕Щр╕Бр╕▓р╕гр╕кр╕╖р╣Ир╕нр╕кр╕▓р╕гр╣Бр╕лр╣Ир╕Зр╕нр╕Щр╕▓р╕Др╕Х! === ЁЯУбЁЯОУ");
    println!("ЁЯМЯ р╕вр╕┤р╕Щр╕Фр╕╡р╕Хр╣Йр╕нр╕Щр╕гр╕▒р╕Ър╕кр╕╣р╣Ир╕лр╕ер╕▒р╕Бр╕кр╕╣р╕Хр╕гр╕Бр╕▓р╕гр╕кр╕╖р╣Ир╕нр╕кр╕▓р╕гр╕Вр╕▒р╣Йр╕Щр╣Ар╕Чр╕Ю! (р╕гр╕▒р╕Ър╕Ыр╕гр╕░р╕Бр╕▒р╕Щр╣Ар╕Бр╣Ир╕Зр╣Бр╕Щр╣Ир╕Щр╕нр╕Щ!) ЁЯПЖтЬи");

    println!("\nЁЯУЪ р╕Ър╕Чр╣Ар╕гр╕╡р╕вр╕Щр╕Чр╕╡р╣И 1: р╣Др╕Ыр╕гр╕йр╕Ур╕╡р╕вр╣Мр╣Бр╕лр╣Ир╕Зр╕нр╕Щр╕▓р╕Др╕Х! ЁЯУотЪб");
    channels_example().await;
    
    println!("\nЁЯУЪ р╕Ър╕Чр╣Ар╕гр╕╡р╕вр╕Щр╕Чр╕╡р╣И 2: р╕Чр╕╡р╕бр╕Ър╕╕р╕гр╕╕р╕йр╣Др╕Ыр╕гр╕йр╕Ур╕╡р╕вр╣Мр╕Лр╕╣р╣Ар╕Ыр╕нр╕гр╣М! ЁЯСеЁЯУотЪб");
    multiple_producers_example().await;
    
    println!("\nЁЯУЪ р╕Ър╕Чр╣Ар╕гр╕╡р╕вр╕Щр╕Чр╕╡р╣И 3: р╕Ир╕Фр╕лр╕бр╕▓р╕вр╕Фр╣Ир╕зр╕Щр╕Юр╕┤р╣Ар╕ир╕й! ЁЯОптЪб");
    oneshot_example().await;
    
    println!("\nЁЯУЪ р╕Ър╕Чр╣Ар╕гр╕╡р╕вр╕Щр╕Чр╕╡р╣И 4: р╕лр╕нр╕Бр╕гр╕░р╕Ир╕▓р╕вр╕Вр╣Ир╕▓р╕зр╣Бр╕лр╣Ир╕Зр╕нр╕Щр╕▓р╕Др╕Х! ЁЯУвтЪб");
    broadcast_example().await;
    
    println!("\nЁЯУЪ р╕Ър╕Чр╣Ар╕гр╕╡р╕вр╕Щр╕Чр╕╡р╣И 5: р╕Ьр╕╣р╣Йр╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Чр╕╡р╕бр╣Бр╕лр╣Ир╕Зр╕нр╕Щр╕▓р╕Др╕Х! ЁЯдЭтЪб");
    coordination_example().await;

    println!("\nЁЯОЙЁЯПЖ === р╕Ир╕Ър╕лр╕ер╕▒р╕Бр╕кр╕╣р╕Хр╕гр╣Бр╕ер╣Йр╕з! р╕Др╕╕р╕Ур╣Ар╕Ыр╣Зр╕Щр╕бр╕▓р╕кр╣Ар╕Хр╕нр╕гр╣Мр╕Бр╕▓р╕гр╕кр╕╖р╣Ир╕нр╕кр╕▓р╕гр╣Бр╕ер╣Йр╕з! === ЁЯПЖЁЯОЙ");
    println!("\nЁЯТбЁЯМЯ р╕кр╕┤р╣Ир╕Зр╕Чр╕╡р╣Ир╕Др╕╕р╕Ур╣Ар╕гр╕╡р╕вр╕Щр╕гр╕╣р╣Йр╣Др╕Фр╣Й (р╕Чр╕▒р╕Бр╕йр╕░р╣Гр╕лр╕бр╣Ир╕Чр╕╡р╣Ир╣Ар╕Ир╣Лр╕Зр╕бр╕▓р╕Б!):");
    println!("   ЁЯУотЪб р╕Бр╕▓р╕гр╣Гр╕Кр╣Й mpsc channels - р╣Др╕Ыр╕гр╕йр╕Ур╕╡р╕вр╣Мр╕лр╕ер╕▓р╕вр╕Др╕Щр╕кр╣Ир╕З р╕Др╕Щр╣Ар╕Фр╕╡р╕вр╕зр╕гр╕▒р╕Ъ!");
    println!("   ЁЯОптЪб р╕Бр╕▓р╕гр╣Гр╕Кр╣Й oneshot channels - р╕Ир╕Фр╕лр╕бр╕▓р╕вр╕Фр╣Ир╕зр╕Щр╕Юр╕┤р╣Ар╕ир╕й!");
    println!("   ЁЯУвтЪб р╕Бр╕▓р╕гр╣Гр╕Кр╣Й broadcast channels - р╕лр╕нр╕Бр╕гр╕░р╕Ир╕▓р╕вр╕Вр╣Ир╕▓р╕зр╕кр╕╕р╕Фр╣Ар╕Ир╣Лр╕З!");
    println!("   ЁЯдЭтЪб р╕Бр╕▓р╕г coordinate tasks р╕Фр╣Йр╕зр╕в channels - р╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Чр╕╡р╕бр╕нр╕вр╣Ир╕▓р╕Зр╕бр╕╖р╕нр╕нр╕▓р╕Кр╕╡р╕Ю!");
    println!("\nЁЯМИтЬи р╕Вр╕нр╣Бр╕кр╕Фр╕Зр╕Др╕зр╕▓р╕бр╕вр╕┤р╕Щр╕Фр╕╡! р╕Др╕╕р╕Ур╕Юр╕гр╣Йр╕нр╕бр╕кр╕гр╣Йр╕▓р╕Зр╣Бр╕нр╕Ыр╕Юр╕ер╕┤р╣Ар╕Др╕Кр╕▒р╕Щр╕кр╕╖р╣Ир╕нр╕кр╕▓р╕гр╣Бр╕лр╣Ир╕Зр╕нр╕Щр╕▓р╕Др╕Хр╣Бр╕ер╣Йр╕з! ЁЯЪАЁЯОК");
}

#[cfg(test)]
mod tests {
    use super::*;
    use tokio::test;

    #[test]
    async fn test_mpsc_channel() {
        let (tx, mut rx) = mpsc::channel::<i32>(5);

        // р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е
        tx.send(1).await.unwrap();
        tx.send(2).await.unwrap();
        tx.send(3).await.unwrap();

        // р╕Ыр╕┤р╕Ф sender
        drop(tx);

        // р╕гр╕▒р╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕е
        assert_eq!(rx.recv().await, Some(1));
        assert_eq!(rx.recv().await, Some(2));
        assert_eq!(rx.recv().await, Some(3));
        assert_eq!(rx.recv().await, None); // channel р╕Ыр╕┤р╕Фр╣Бр╕ер╣Йр╕з
    }

    #[test]
    async fn test_oneshot_channel() {
        let (tx, rx) = oneshot::channel::<String>();

        // р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е
        tx.send("test message".to_string()).unwrap();

        // р╕гр╕▒р╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕е
        let result = rx.await.unwrap();
        assert_eq!(result, "test message");
    }

    #[test]
    async fn test_broadcast_channel() {
        let (tx, mut rx1) = broadcast::channel::<i32>(5);
        let mut rx2 = tx.subscribe();

        // р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е
        tx.send(42).unwrap();
        tx.send(84).unwrap();

        // р╕Чр╕▒р╣Йр╕Зр╕кр╕нр╕З receivers р╕Др╕зр╕гр╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Ар╕Фр╕╡р╕вр╕зр╕Бр╕▒р╕Щ
        assert_eq!(rx1.recv().await.unwrap(), 42);
        assert_eq!(rx2.recv().await.unwrap(), 42);

        assert_eq!(rx1.recv().await.unwrap(), 84);
        assert_eq!(rx2.recv().await.unwrap(), 84);
    }

    #[test]
    async fn test_multiple_producers() {
        let (tx, mut rx) = mpsc::channel::<i32>(10);

        // р╕кр╕гр╣Йр╕▓р╕З 2 producers
        let tx1 = tx.clone();
        let tx2 = tx.clone();

        let producer1 = tokio::spawn(async move {
            tx1.send(1).await.unwrap();
            tx1.send(2).await.unwrap();
        });

        let producer2 = tokio::spawn(async move {
            tx2.send(10).await.unwrap();
            tx2.send(20).await.unwrap();
        });

        // р╕Ыр╕┤р╕Ф original sender
        drop(tx);

        // р╕гр╕нр╣Гр╕лр╣Й producers р╣Ар╕кр╕гр╣Зр╕И
        let _ = tokio::join!(producer1, producer2);

        // р╕гр╕▒р╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф
        let mut received = Vec::new();
        while let Some(value) = rx.recv().await {
            received.push(value);
        }

        // р╕Др╕зр╕гр╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕е 4 р╕Хр╕▒р╕з
        assert_eq!(received.len(), 4);

        // р╣Ар╕гр╕╡р╕вр╕Зр╕ер╕│р╕Фр╕▒р╕Ър╣Ар╕Юр╕╖р╣Ир╕нр╣Ар╕Ыр╕гр╕╡р╕вр╕Ър╣Ар╕Чр╕╡р╕вр╕Ъ
        received.sort_unstable();
        assert_eq!(received, vec![1, 2, 10, 20]);
    }
}
